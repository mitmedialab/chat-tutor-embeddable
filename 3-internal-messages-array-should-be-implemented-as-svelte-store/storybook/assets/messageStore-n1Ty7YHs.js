import{n as p,s as S}from"./index-Rea00llB.js";const i=[];function T(t,e=p){let s;const a=new Set;function r(o){if(S(t,o)&&(t=o,s)){const c=!i.length;for(const n of a)n[1](),i.push(n,t);if(c){for(let n=0;n<i.length;n+=2)i[n][0](i[n+1]);i.length=0}}}function d(o){r(o(t))}function u(o,c=p){const n=[o,c];return a.add(n),a.size===1&&(s=e(r,d)||p),o(t),()=>{a.delete(n),a.size===0&&s&&(s(),s=null)}}return{set:r,update:d,subscribe:u}}const h=()=>new Date().toLocaleTimeString(navigator.language,{hour:"2-digit",minute:"2-digit"}),y=(t,{addEndpoint:e})=>(t.time_created=t.timestamp,t.chat_k="To set chat id",t.clear_number="0",fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})),_=async(t,{model:e,collections:s,askEndpoint:a})=>fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation:t,selectedModel:e,multiple:!0,credential_token:"none",collection:s})}),w=t=>t.split(`

`).filter(Boolean).map(e=>{try{return JSON.parse(e.split("data: ")[1])}catch(s){return console.error(s),null}}),x=async(t,e,s,a)=>{const r=await _(t,e);let d;const u=r.body.getReader();let o;async function c(){const n=await u.read();if(n.done)return;const g=new TextDecoder().decode(n.value),b=w(g);for(const f of b){if(f===null)continue;const{message:{valid_docs:O,content:m}}=f;o?a(m??""):o=s({sender:"Assistant",timestamp:h(),role:"assistant",content:m??"",valid_docs:d})}await c()}await c(),o?y(o,e):console.error("No message received from ChatTutor")},M="Welcome",C={sender:"Assistant",role:"assistant",content:M,timestamp:h()},l=T([]),D=t=>{l.update(e=>[...e,t])},N=t=>{l.update(e=>(e[e.length-1].content=t,e))},q=t=>{l.update(e=>(e[e.length-1].content+=t,e))},J=()=>{l.set([C])};export{D as a,q as b,y as c,x as d,l as m,h as n,J as r,N as u};
